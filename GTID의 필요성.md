- GTID


# [[바이너리 로그 파일 위치 기반 복제]]의 문제점

![[Pasted image 20240409110654.png]]
- 위 복제[[토폴로지]]는 1개의 소스서버, 2개의 부하 분산, 통계, 배치 레플리카 서버로 구성
- A와 B는 동기화가 완료, C는 지연

1. A서버에서 장애 발생
2. B,C중에서 동기화가 완료된 B서버를 소스 서버로 승격
3. 새로운 소스 서버로 승격된 후 B서버가 클라이언트의 요청도 병행하며 수행
4. 기존의 역할과 소스 서버의 역할로 인한 B서버의 과부화 발생


- C서버는 어느 시점에서든 지연된 시점에서 동기화를 완료할 수 없음 
	- [[릴레이 로그]]를 활용할 수 있지만 로그가 삭제되지 않고 남아있을 가능성은 낮음



## GTID의 필요성

앞서 말한 바이너리 로그 파일의 문제점을 대신해서 글로벌 트랜잭션을 사용했다고 가정하기

![[Pasted image 20240409113618.png]]

1. 소스서버 A장애 발생
2. B서버를 C서버의 소스 서버가 되도록 변경
	 - `CHANGE REPLICATION SOURCE TO SOURCE_HOST='B', SOURCE_PORT='3306` 실행
3. C서버에서 현재 실행한 트랜잭션이후 로그를 B서버로 부터 바이너리 로그 이벤트를 가져와서 동기화
4. B서버는 소스서버, C는 B의 레플리카 서버로 변경


