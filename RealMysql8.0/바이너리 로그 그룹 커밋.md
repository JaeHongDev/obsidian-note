
MySQL 5.5버전까지는 InnoDB 스토리지 엔진에서 한 시점에 하나의 트랜잭션만 커밋될 수 있었으며, 바이너리 로그에 트랜잭션을 기록하고 디스크와 동기화하는 부분도 여러 트랜재겻ㄴ이 동시에 진행될 수 없었다.
![[Pasted image 20240423113141.png]]

클라이언트로부터 커밋 요청이 들어오면 Prepare, Commit 두 단계를 거쳐 커밋을 처리
이를 분산 트랜잭션이라 합니다. 

1. 클라이언트 commit
2. prepare
3. write
4. fsyc
5. commit

커밋을 처리하는 과정에서 바이너리 로그에 기록한 내용을 디스크와 동기화하는 fsync 작업은 빈번하게 수행도는 디스크 동기화 작업으로 서버에 부하를 줬으며 트랜잭션 처리량을 저하를 야기하기도 했습니다. 


이런 문제점을 극복하기 위해 바이너리 로그 그룹 커밋 기능이 도입됐습니다



## 동작 방식

바이너리 로그 그룹 커밋에서 트랜잭션 커밋 처리 과정 중 Prepare 이후 다음과 같은 단계를 거칩니다. 
1. [[FLUSH 단계]]
2. [[Sync 단계]]
3. [[Commit 단계]]

각 단계에는 대기 큐가 존재하며, 트랜잭션들은 순서대로 대기 큐에 등록됩니다.
팔로워는 리더에게 자신의 트랜잭션 처리에 대한 모든 것을 일임하며, 리더는 큐에 등록된 모든 팔로워들을 가져와 처리하고 다음 단계의 대기 큐에 등록합니다.

다음 단계의 큐에 등록될 떄는 큐가 비어있지 않은 경우 리더는 팔로워가 되고 해당 큐의 리더가 그 단계에서의 처리를 주도하게 됩니다. 


