
![[Pasted image 20240416145334.png]]

## 정의
멀티 소스 복제 구성은 하나의 레플리카 서버가 둘 이상의 소스 서버를 갖는 형태를 말합니다.



## 목적
- 여러 MySQL 서버에 존재하는 각기 다른 데이터를 하나의 MySQL 서버로 통합
- 여러 MySQL 서버에 샤딩돼 있는 테이블 데이터를 하나의 테이블로 통합
- 여러 MySQL 서버의 데이터들을 모아 하나의 MySQL 서버에서 백업을 수행

## 용도
- 분석에 필요한 데이터들이 여러 곳에 나눠져 있어 이를 한곳으로 모아 좀 더 빠르고 편리하게 분석을  수행하자 할 때 유용하다. 
- 늘어난 서비스 트래픽에 대비해 사전에 MySQL 서버들을 샤드 형태로 구성했으나 유입되지 않는 경우 멀티 소스 복제를 구성해 샤딩된 데이터를 통합해 MySQL 서버 수를 줄일 수 있다. 
- 다수의 MySQL 서버의 데이터를 하나의 MySQL 서버에서 백업하고자 할 때 

## 주의
1. 멀티 소스 복제 형태를 사용할 때 각 소스 서버로부터 유입되는 변경 이벤트들이 레플리카 서버로 복제 됐을 때 서로 충돌을 일으킬 만한 부분이 없는지 검토해야 함
2. 멀티 소스 복제의 레플리카 서버는 각 소스 서버들의 대체 서버로 사용하기에 어려움이 있기 때문에 장비 대비용 레플리카 서버는 멀티 소스가 아닌 소스 서버와 일대일 복제로 연결된 별도의 서버로 구축하느 ㄴ것이 좋음

## 동작
- MySQL의 멀티 소스 복제에서 레플리카 서버는 자신과 연결된 소스 서버들의 변경 이벤트들을 동시점에 병렬로 동기화 합니다. 
- 이는 채널이라고 각각의 독립된 복제를 처리하며 소스 서버들에 대한 복제가 독립적으로 처리된다.
- 각 복제 채널은 개별적인 [[../레플리케이션 IO 스레드|레플리케이션 IO 스레드]], [[../릴레이 로그|릴레이 로그]], [[../레플리케이션 SQL 스레드|레플리케이션 SQL 스레드]]를 가지며 소스 서버와의 복제 연결인지를 구별할 수 있는 식별자 역할을 하며 최대 256개의 복제 채널을 생성할 수 있다. 
![[Pasted image 20240416151000.png]]
- 사용자는 복제를 설정하는 `CHANGE REPLICATION SOURCE TO` 명령에서 `FOR CHANNEL `구문을 사용해서 복제 채널명을 지정할 수 있다. 
![[Pasted image 20240416151045.png]]


구축 방식은 506p참고