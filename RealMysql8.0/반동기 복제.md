
반동기 복제는 비동기 복제보다 더 나은 데이터 무결성을 제공하는 복제 동기화 방식입니다. 
## 특징
- 반동기 복제에서 소스 서버는 레플리카 서버가 소스 서버로부터 전달받은 변경 이벤트를 릴레이 로그에 기록 후 응답을 보내면 트랜잭션을 완전히 커밋시키고 클라이언트에 결과를 반환합니다.
- 정상적으로 결과가 반환된 모든 트랜잭션에 대해 적어도 하나 이상의 레플리카 서버에는 해당 트랜잭션들이 전송됐음을 보장합니다. 
- `참고로 트랜잭션의 전송을 보장할 뿐 적요까지 보장하는 것은 아닙니다.`(반동기 복제라는 이름의 이유)

반동기 복제에서 소스 서버가 트랜잭션 처리 중 어느 지점에 레플리카 서버의 응답을 기다리느냐에 따라 소스 서버에서 장애가 발생했을 때 사용자가 겪을 수 있는 문제상황이 다릅니다.

사용자는 `rpl_semi_sync_master_wait_point` 시스템 변수를 통해 소스 서버가 레플리카 서버의 응답을 기다리는 지점을 제어할 수 있다.
- [[AFTER_SYNC]]
- [[AFTER_COMMIT]]
값에 따라 반동기 복제 방식이 다르다 


## AFTER_COMMIT, AFTER_SYNC 비교
AFTER_SYNC방식은 AFTER_COMMIT과 비교해서 다음과 같은 장점이 있습니다.
1. 소스 서버에 장애가 발생했을 때 [[팬텀 리드]]가 발생하지 않음
2. 장애가 발생한 소스 서버에 대해 좀더 수월하게 복구 처리가 가능

AFTER_SYNC 방식은  스토리지 엔진 커밋 전에 레플리카 서버의 응답을 기다리므로 응답을 기다리던 중 소스 서버에 장애가 발생하더라도 팬텀 리드가 발생하지 않음

즉 AFTER_SYNC는 AFTER_COMMIT보다 데이터 무결성이 강화된 방식

> [!주의]
> 
> 반동기 복제라 하더라도 소스 서버에 장애가 발생했을 때 소스 서버의 데이터와 레플리카 서버의 데이터가 달라지는 경우가 발생하면 장애가 발생한 소스 서버를 재사용하지 않는 것이 좋다. 




## 반동기 vs 비동기 
- 트랜잭션을 처리하는 중에 레플리카 서버의 응답을 기다리기 때문에 반동기 복제는 비동기 방식보다 트랜잭션의 처리속도가 더 느릴 수 있다. 
	1. 응답 요청을 전달받기 까지의 네트워크 왕복 시간
	2. 서버에서 응답이 늦어지는 경우 트랜잭션 처리의 지연
- 물론 타임아웃 제한 시간을 넘으면 비동기 방식으로 전환함


## [[반동기 복제 설정 방법]]
