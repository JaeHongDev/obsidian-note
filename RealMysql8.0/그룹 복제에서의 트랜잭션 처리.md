
그룹 복제에서 트랜잭션은 다음 단계들을 거친 후 최종적으로 그룹의 각 서버들에 적용
1. [[합의(Consensus)]]
2. [[인증(Certification)]]


### 그룹 복제에서 트랜잭션이 처리되는 과정
![[Pasted image 20240430021643.png]]



## 트랜잭션 일관성 수준 

그룹 복제에서 멤버들은 동일한 트랜잭션을 적용하지만 실제 적용 시점까지 완전히 일치 하지 않습니다. 쓰기를 수행한 후 다른 멤버에서 데이터를 읽는 경우 데이터가 없거나 프라이머리 장애로 페일오버가 발생한 경우 아주 짧은 시간 내 동기화가 안되는 문제가 있었다.

MySQL 8.0.14 버전부터 그룹 복제에서 `group_replication_consistency` 시스템 변수를 통해 트랜잭션의 일관성 수준을 설정할 수 있게 됐습니다.
- [[EVENTUAL 일관성 수준]]
- [[BEFORE_ON_PRIMARY_FAILOVER 일관성 수준]]
- [[BEFORE 일관성 수준]]
- [[AFTER 일관성 수준]]
- [[BEFORE_AND_AFTER 일관성 수준]]



## 흐름 제어

그룹 복제에서 아래의 상황에서 트랜잭션 적용이 지연될 수 있으며 나아가 트랜잭션과 충돌할 위험이 있다.
- 하드웨어 스펙이 더 낮거나 
- 네트워크 대역폭이 작은 경우
- 부하를 더 많이 받는 경우
그룹 복제에서 이런 문제를 해결하기위해 등장한 것이 흐름제어이다.


### 특징
1. 흐름 제어를 통해 멤버 간 트랜잭션 갭을 적게 유지해서 최대한 동기화된 상태로 유지될 수 있도록 함
2. 평소와 다른 [[워크로드]]가 유입되는 등의 변화에도 빠르게 적응해서 쓰기 처리량을 균등하게 함
3. 필요 이상으로 처릴향을 줄이지 않음으로써 서버의 자원이 불필요하게 유휴 상태에 놓여 있지 않게 함

### 사용법
- `group_replication_flow_control_mode` 시스템 변수를 통해 멤버에서 흐름 제어 기능의 사용 여부를 설정할 수 있다.
	- [[QUOTA]]: 기본 모드로 하나만 존재함
	- `DISABLED`: 흐름제어 사용하지 않음

### 흐름제어에서 공유되는 정보
- 인증 큐 크기
- 적용 큐 크기
- 인증된 총 트랜잭션 수
- 적용된 원격 트랜잭션 수
- 로컬 트랜잭션 수



## 그룹 복제의 자동 장애 감지 및 대응

그룹 복제에서는 그룹의 일부 멤버에 장애가 발생한 경우 해당 멤버를 그룹 복제에서 제외시킴으로써 그룹이 정상적으로 동작 중인 멤버로만 구성될 수 있게 하고 클라이언트 요청이 문제없이 처리될 수 있게 한다. 

- 그룹 복제 멤버 간에 통신 메시지를 주고받으며 서로의 상태를 확인
- 5초 내로 메시지를 받지 않는다면 해당 멤버에 문제가 생긴 것으로 `의심`
- 장애가 의심되는 멤버에 대해 과반수의 멤버가 동의하면 그룹에서 `추방`
	- 5초의 대기 시간이 추가되며 `UNREACHABLE` 상태로 변경
- 추방된 멤버는 그룹 멤버들의 뷰 ID와 다르기 때문에 충반된 것을 알게 됌
- `group_replication_authorejoin_tries` 시스템 변수에 값에 따라 그룹 재가입 시도를 함
- 