
데이터베이스 기반 멀티 스레드 복제 방식은 스키마 기반 처리 방식이라고도 부릅니다.

## 정의
이름 그래도 데이터베이스 단위로 병렬 처리를 수행하는 형태


## 단점
MySQL서버에 데이터베이스가 하나밖에 존재하지 않는다면 데이터베이스 기반 복제는 아무런 장점이 없다. 


## 동작 방식
![[Pasted image 20240423101220.png]]

- 코디네이터 스레드는 릴레이 로그 파일에서 이벤트를 읽어 데이터베이스 단위로 분리하고 각 워커 스레드에게 이벤트들을 할당
- 워커 스레드가 할당된 큐에 맞춰 이벤트들을 처리


## 코디네이터 스레드의 역할
코디네이터 스레드는 단순히 데이터베이스 다누이로 바이너리 로그 이벤트를 워커 스레드별로 분산하는 역할만 있는 것은 아닙니다. 

트랜잭션에 맞춰 워커 스레드에 이벤트를 할당 

![[Pasted image 20240423110605.png]]

1. DB1이벤트를 첫 번째 워커 스레드에 할당
2. DB2이벤트를 두 번째 워커 스레드에 전달
3. 세 번째 트랜잭션의 첫 번째 DML 문장에서 DB3를 DB1,DB2와 충돌하지 않는 것을 확인 후 세 번째 워커 스레드에 할당
4. DB1의 경우 첫 번째 워커 스레드에 이미 처리중이기 떄문에 DB1을 완료할 때 까지 기다린다. 

문제저 
데이터베이스 기반 멀티 스레드 복제에서 테이블이나 레코드 수준까지의 충돌 여부를 고려하지 않고, 데이터베이스가 동일한지 아닌지만 비교해서 병렬 처리를 수행

만약 워커 스레드 1, 2, 3에서 두 번째 워커스레드가 완료된 상황에서 다음 트랜잭션을 처리하고자 할 때 이전 트랜잭션이 완료되지 않았다면 대기한다. 
